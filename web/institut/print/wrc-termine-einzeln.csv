<%@ page contentType="application/vnd.ms-excel" errorPage="../json/error.jsp" session="true" import="de.shj.UP.data.shjCore,de.shj.UP.HTML.HtmlDate,java.sql.ResultSet" %><jsp:useBean id="user" scope="session" class="de.shj.UP.data.Dozent" /><%
    int ii=1;
    ResultSet rStudierende=user.sqlQuery("SELECT " +
        "s.\"dtmSprechstundeDatum\", " +
        "s.\"tmeSprechstundeStart\", " +
        "s.\"tmeSprechstundeStop\", " +
        "n.\"strNutzerInstitut\", " +
        "n.\"intNutzerLevel\" " +
      "FROM " +
        "\"tblBdSprechstunde\" s, " +
        "\"tblSdNutzer\" n " +
      "WHERE " +
        "n.\"strNutzerUniID\" = s.\"strNutzerUniID\" AND " +
        "s.\"lngSdSeminarID\" = 1 AND " +
        "s.\"lngDozentID\" in (273,438) " +
    "union " +
    "SELECT s2.\"dtmSprechstundeDatum\"," +
           "s2.\"tmeSprechstundeStart\"," +
           "s2.\"tmeSprechstundeStop\"," +
           "'Termin nicht belegt'," +
           "-1 " +
    "FROM \"tblBdSprechstunde\" s2 " +
    "WHERE s2.\"strNutzerUniID\" is null " +
      "AND s2.\"lngSdSeminarID\" = 1 " +
      "AND s2.\"lngDozentID\" in (273,438) " +
        "order by \"dtmSprechstundeDatum\", \"tmeSprechstundeStart\";");
//System.out.println("SELECT " +
//        "s.\"dtmSprechstundeDatum\", " +
//        "s.\"tmeSprechstundeStart\", " +
//        "s.\"tmeSprechstundeStop\", " +
//        "n.\"strNutzerInstitut\", " +
//        "n.\"intNutzerLevel\" " +
//      "FROM " +
//        "\"tblBdSprechstunde\" s, " +
//        "\"tblSdNutzer\" n " +
//      "WHERE " +
//        "n.\"strNutzerUniID\" = s.\"strNutzerUniID\" AND " +
//        "s.\"lngSdSeminarID\" = 1 AND " +
//        "s.\"lngDozentID\" = 273 " +
//        "order by \"dtmSprechstundeDatum\", \"tmeSprechstundeStart\";");
%>"Lfd.Nr.";"Datum";"Start";"Stop";"Institut";"Level";<%while(rStudierende.next()){%>
<%=ii++ + ";" + 
    shjCore.g_GERMAN_DATE_FORMAT.format(rStudierende.getDate("dtmSprechstundeDatum")) + ";" + 
    rStudierende.getString("tmeSprechstundeStart").substring(0,5) + ";" + 
    rStudierende.getString("tmeSprechstundeStop").substring(0,5) + ";" + 
    rStudierende.getString("strNutzerInstitut") + ";" + 
    getLevel(rStudierende.getInt("intNutzerLevel"))%><%}%>
<%!String getLevel(int i){//#nutzer_level (1 BA, 2 MA, 3 PhD, 4 Colleague, 5 Lehramt, 6 Diplom, 7 Lehramt)
switch(i){
case 1: return "Studierende(r) BA";
case 2: return "Studierende(r) MA";
case 3: return "DoktorandIn";
case 4: return "KollegIn";
case 6: return "Studierende(r) Diplom";
case 7: return "Studierende(r) Lehramt";
default: return "Level nicht bekannt";
}
}
%>